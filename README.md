# Metrics Library

Библиотека для сбора, обработки и асинхронной записи метрик производительности в файл.

## Описание

Metrics Library - это C++ библиотека, предназначенная для сбора и сохранения метрик в текстовом формате. Метрики представляют собой именованные события, которые могут происходить в произвольные моменты времени, с соответствующими значениями заданного типа данных.

Библиотека поддерживает различные типы метрик:
- **Gauge** - для вещественных значений (например, утилизация CPU)
- **Counter** - для целочисленных значений (например, количество HTTP-запросов)

## Особенности

- **Расширяемость**: Возможность добавлять новые типы метрик без изменения существующего кода
- **Асинхронность**: Запись метрик не блокирует потоки, в которых происходят события
- **Потокобезопасность**: Безопасное использование из нескольких потоков
- **Автоматический сброс**: После записи метрик накопленные значения обнуляются

## Формат вывода

Каждая запись метрик представляет собой отдельную строку в формате:
```
YYYY-MM-DD HH:MM:SS.mmm "Metric1_Name" Value1 "Metric2_Name" Value2 ...
```

Пример:
```
2023-11-15 14:30:01.653 "CPU" 0.97 "HTTP_requests_RPS" 42
2023-11-15 14:30:02.653 "CPU" 1.12 "HTTP_requests_RPS" 30
```

## Примеры использования

### Базовый пример

```cpp
#include "metrics_library.h"

int main() {
    // Создание сборщика метрик
    MetricsCollector collector("metrics.txt");
    
    // Создание метрик
    auto cpuMetric = std::make_shared<Gauge>("CPU");
    auto requestsMetric = std::make_shared<Counter>("HTTP_requests");
    
    // Добавление метрик в сборщик
    collector.addMetric(cpuMetric);
    collector.addMetric(requestsMetric);
    
    // Обновление значений метрик
    cpuMetric->update(1.25);
    requestsMetric->increment(42);
    
    // Сбор и запись метрик в файл
    collector.collectAndWrite();
    
    return 0;
}
```

### Многопоточный пример

Библиотека поддерживает сбор метрик из нескольких потоков. Пример можно найти в файле `src/main.cpp`.

## Сборка и запуск

### Требования

- C++17 совместимый компилятор
- CMake 3.10 или выше
- Библиотека потоков (обычно включена в стандартную библиотеку)

### Сборка

```bash
mkdir build && cd build
cmake ..
cmake --build .
```

### Запуск примеров

```bash
# Запуск основного примера
./bin/main

# Запуск упрощенного примера
./bin/metrics_example

# Запуск тестов
./bin/metrics_tests
```

## Структура проекта

- **include/** - заголовочные файлы
  - **metrics_library.h** - основной заголовочный файл библиотеки
  - **logger.h** - класс для логирования
  - **metrics_tests.h** - заголовочный файл для тестов
- **src/** - исходные файлы
  - **metrics_library.cpp** - реализация классов библиотеки
  - **main.cpp** - пример использования библиотеки с многопоточной симуляцией
  - **metrics_example.cpp** - упрощенный пример использования
- **tests/** - тесты
  - **metrics_tests.cpp** - модульные тесты для библиотеки
